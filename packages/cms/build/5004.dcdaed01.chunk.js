"use strict";(self.webpackChunk_MokoshAI_cms=self.webpackChunk_MokoshAI_cms||[]).push([[5004],{13635:(Q,C,s)=>{s.d(C,{u:()=>B});var t=s(2730),L=s(43348),i=s(96508),m=s(91155);const B=(h={},c)=>{const{locale:I}=(0,i.A)(),A=(0,L.QM)(I,{sensitivity:"base"}),{data:l,error:U,isError:T,isLoading:R,refetch:W}=(0,m.z)(h,c);return{roles:t.useMemo(()=>[...l??[]].sort((K,f)=>A.compare(K.name,f.name)),[l,A]),error:U,isError:T,isLoading:R,refetch:W}}},25004:(Q,C,s)=>{s.d(C,{ProtectedEditPage:()=>Z});var t=s(58466),L=s(2730),i=s(45227),m=s(16113),B=s(38973),h=s(12688),c=s(61680),I=s(18834),A=s(15659),l=s(59979),U=s(88663),T=s(50389),R=s(13775),W=s(20128),o=s(43348),K=s(63440),f=s(85209),p=s(96508),j=s(77645),X=s(37299),x=s(69093),e=s(91155),Y=s(13635),$=s(86962),ns=s(79412),Es=s(9361),is=s(95052),rs=s(50682),ds=s(20153),ls=s(76024),es=s(34511),Ms=s(43900),Ps=s(85041),Ds=s(3891),Os=s(90588),ms=s(49382),hs=s(12762),As=s(19292),Rs=s(9174),gs=s(6056),vs=s(33854),Cs=s(31075),Ls=s(19727),Bs=s(8184),cs=s(11001),Is=s(15778),Us=s(81806),Ts=s(95431),Ws=s(55688),Ks=s(32962),fs=s(40060),js=s(26208),xs=s(31666),us=s(69506),ys=s(3691),ps=s(2119),Ss=s(46705),Fs=s(59362),Ns=s(98907),zs=s(28685),Vs=s(45946),Qs=s(6377),Xs=s(71484),Ys=s(97755),$s=s(85960),Gs=s(25395),Hs=s(35771),Js=s(3330),Zs=s(27488);const G=({disabled:n,role:a,values:D,errors:_,onChange:r,onBlur:g})=>{const{formatMessage:E}=(0,p.A)();return(0,t.jsx)(i.a,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsxs)(l.s,{direction:"column",alignItems:"stretch",gap:4,children:[(0,t.jsxs)(l.s,{justifyContent:"space-between",children:[(0,t.jsxs)(i.a,{children:[(0,t.jsx)(i.a,{children:(0,t.jsx)(R.o,{fontWeight:"bold",children:a?a.name:E({id:"global.details",defaultMessage:"Details"})})}),(0,t.jsx)(i.a,{children:(0,t.jsx)(R.o,{textColor:"neutral500",variant:"pi",children:a?a.description:E({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})})})]}),(0,t.jsx)(m.$,{disabled:!0,variant:"secondary",children:E({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:a.usersCount})})]}),(0,t.jsxs)(B.x,{gap:4,children:[(0,t.jsx)(h.E,{col:6,children:(0,t.jsx)(U.k,{disabled:n,name:"name",error:_.name&&E({id:_.name}),label:E({id:"global.name",defaultMessage:"Name"}),onChange:r,onBlur:g,required:!0,value:D.name||""})}),(0,t.jsx)(h.E,{col:6,children:(0,t.jsx)(T.T,{disabled:n,label:E({id:"global.description",defaultMessage:"Description"}),id:"description",error:_.name&&E({id:_.name}),onChange:r,onBlur:g,children:D.description||""})})]})]})})},H=x.Ik().shape({name:x.Yj().required(o.iW.required),description:x.Yj().optional()}),J=()=>{const n=(0,o.hN)(),{formatMessage:a}=(0,p.A)(),_=(0,j.W5)("/settings/roles/:id")?.params.id,r=L.useRef(null),{lockApp:g,unlockApp:E}=(0,o.MA)(),{trackUsage:b}=(0,o.z1)(),{_unstableFormatAPIError:S,_unstableFormatValidationErrors:F}=(0,o.wq)(),{isLoading:w,data:N}=(0,e.A)({role:_??""}),{roles:k,isLoading:z,refetch:q}=(0,Y.u)({id:_},{refetchOnMountOrArgChange:!0}),P=k[0]??{},{data:ss,isLoading:ts}=(0,e.B)({id:_},{skip:!_,refetchOnMountOrArgChange:!0}),[_s]=(0,e.G)(),[as]=(0,e.E)();if(!_)return(0,t.jsx)(j.rd,{to:"/settings/roles"});const os=async(u,v)=>{try{g();const{permissionsToSend:O,didUpdateConditions:y}=r.current?.getPermissions()??{},d=await _s({id:_,...u});if("error"in d){(0,e.x)(d.error)&&d.error.name==="ValidationError"?v.setErrors(F(d.error)):n({type:"warning",message:S(d.error)});return}if(P.code!=="strapi-super-admin"&&O){const M=await as({id:d.data.id,permissions:O});if("error"in M){(0,e.x)(M.error)&&M.error.name==="ValidationError"?v.setErrors(F(M.error)):n({type:"warning",message:S(M.error)});return}y&&b("didUpdateConditions")}r.current?.setFormAfterSubmit(),await q(),n({type:"success",message:{id:"notification.success.saved"}})}catch{n({type:"warning",message:{id:"notification.error"}})}finally{E()}},V=!z&&P.code==="strapi-super-admin";return(0,t.jsxs)(A.g,{children:[(0,t.jsx)(o.x7,{name:"Roles"}),(0,t.jsx)(f.l1,{enableReinitialize:!0,initialValues:{name:P.name??"",description:P.description??""},onSubmit:os,validationSchema:H,validateOnChange:!1,children:({handleSubmit:u,values:v,errors:O,handleChange:y,handleBlur:d,isSubmitting:M})=>(0,t.jsxs)("form",{onSubmit:u,children:[(0,t.jsx)(I.Q,{primaryAction:(0,t.jsx)(l.s,{gap:2,children:(0,t.jsx)(m.$,{type:"submit",disabled:P.code==="strapi-super-admin",loading:M,size:"L",children:a({id:"global.save",defaultMessage:"Save"})})}),title:a({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:a({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:(0,t.jsx)(W.N,{as:X.k2,startIcon:(0,t.jsx)(K.A,{}),to:"/settings/roles",children:a({id:"global.back",defaultMessage:"Back"})})}),(0,t.jsx)(c.s,{children:(0,t.jsxs)(l.s,{direction:"column",alignItems:"stretch",gap:6,children:[(0,t.jsx)(G,{disabled:V,errors:O,values:v,onChange:y,onBlur:d,role:P}),!w&&!z&&!ts&&N?(0,t.jsx)(i.a,{shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)($.P,{isFormDisabled:V,permissions:ss,ref:r,layout:N})}):(0,t.jsx)(i.a,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(o.Bl,{})})]})})]})})]})},Z=()=>{const n=(0,e.j)(r=>r.admin_app.permissions.settings?.roles),{isLoading:a,allowedActions:{canRead:D,canUpdate:_}}=(0,o.ec)(n);return a?(0,t.jsx)(o.Bl,{}):!D&&!_?(0,t.jsx)(j.rd,{to:"/"}):(0,t.jsx)(J,{})}}}]);

"use strict";(self.webpackChunk_contentweaver_cms=self.webpackChunk_contentweaver_cms||[]).push([[6601,8720],{6503:(Y,B,e)=>{e.d(B,{u:()=>O});var s=e(91155);const m=s.n.injectEndpoints({endpoints:M=>({getWebhooks:M.query({query:o=>({url:`/admin/webhooks/${o?.id??""}`,method:"GET"}),transformResponse:o=>Array.isArray(o.data)?o.data:[o.data],providesTags:(o,_,D)=>typeof D=="object"&&"id"in D?[{type:"Webhook",id:D.id}]:[...o?.map(({id:W})=>({type:"Webhook",id:W}))??[],{type:"Webhook",id:"LIST"}]}),createWebhook:M.mutation({query:o=>({url:"/admin/webhooks",method:"POST",data:o}),transformResponse:o=>o.data,invalidatesTags:[{type:"Webhook",id:"LIST"}]}),updateWebhook:M.mutation({query:({id:o,..._})=>({url:`/admin/webhooks/${o}`,method:"PUT",data:_}),transformResponse:o=>o.data,invalidatesTags:(o,_,{id:D})=>[{type:"Webhook",id:D}]}),triggerWebhook:M.mutation({query:o=>({url:`/admin/webhooks/${o}/trigger`,method:"POST"}),transformResponse:o=>o.data}),deleteManyWebhooks:M.mutation({query:o=>({url:"/admin/webhooks/batch-delete",method:"POST",data:o}),transformResponse:o=>o.data,invalidatesTags:(o,_,{ids:D})=>D.map(W=>({type:"Webhook",id:W}))})}),overrideExisting:!1}),{useGetWebhooksQuery:K,useCreateWebhookMutation:T,useUpdateWebhookMutation:L,useTriggerWebhookMutation:S,useDeleteManyWebhooksMutation:b}=m,O=(M=void 0,o)=>{const{data:_,isLoading:D,error:W}=K(M,o),[k,{error:j}]=T(),[H,{error:I}]=L(),[V]=S(),[z]=b();return{webhooks:_,isLoading:D,error:W||j||I,createWebhook:k,updateWebhook:H,triggerWebhook:V,deleteManyWebhooks:z}}},18720:(Y,B,e)=>{e.d(B,{E:()=>oe,a:()=>F,b:()=>Se});var s=e(58466),m=e(2730),K=e(78885),T=e(45227),L=e(16113),S=e(15763),b=e(99955),O=e(95504),M=e(71871),o=e(38973),_=e(12688),D=e(61680),W=e(18834),k=e(59754),j=e(15659),H=e(9636),I=e(84135),V=e(45403),z=e(12213),Z=e(17133),u=e(59979),ie=e(69675),G=e(88663),y=e(13775),de=e(9891),p=e(43348),le=e(37299),J=e(77645),N=e(91155),w=e(37724),_e=e(89142),Ee=e(20128),ce=e(63440),q=e(81100),ee=e(81244),he=e(94837),ge=e(95638),Me=e(53176),C=e(85209),R=e(96508),x=e(69093),Pe=e(39418),X=e(86784),me=e(6503);const[ue,se]=(0,Pe.q)("WebhookEvent"),De=({children:t})=>{const{formatMessage:n}=(0,R.A)(),{collectionTypes:a,isLoading:E}=(0,w.u)(),r=m.useMemo(()=>a.some(i=>i.options?.draftAndPublish===!0),[a]),c=n({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return(0,s.jsx)(ue,{isDraftAndPublish:r,children:(0,s.jsxs)(u.s,{direction:"column",alignItems:"stretch",gap:1,children:[(0,s.jsx)(M.d,{"aria-hidden":!0,children:c}),E&&(0,s.jsx)(k.a,{children:n({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})}),(0,s.jsx)(Oe,{"aria-label":c,children:t})]})})},Oe=(0,X.Ay)(H.X)`
  tbody tr:nth-child(odd) {
    background: ${({theme:t})=>t.colors.neutral100};
  }

  thead th span {
    color: ${({theme:t})=>t.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:t})=>t.spaces[3]};
    padding-block-end: ${({theme:t})=>t.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:t})=>t.spaces[2]};
  }
`,ve=t=>{const n=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return t&&(n.push({id:"app.utils.publish",defaultMessage:"Publish"}),n.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),n},fe=({getHeaders:t=ve})=>{const{isDraftAndPublish:n}=se("Headers"),{formatMessage:a}=(0,R.A)(),E=t(n);return(0,s.jsx)(V.r,{children:(0,s.jsxs)(Z.N,{children:[(0,s.jsx)(I.e,{children:(0,s.jsx)(de.s,{children:a({id:"Settings.webhooks.event.select",defaultMessage:"Select event"})})}),E.map(r=>["app.utils.publish","app.utils.unpublish"].includes(r?.id??"")?(0,s.jsx)(I.e,{title:a({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"}),children:(0,s.jsx)(y.o,{variant:"sigma",textColor:"neutral600",children:a(r)})},r.id):(0,s.jsx)(I.e,{children:(0,s.jsx)(y.o,{variant:"sigma",textColor:"neutral600",children:a(r)})},r.id))]})})},Ae=({providedEvents:t})=>{const{isDraftAndPublish:n}=se("Body"),a=t||Ce(n),{values:E,handleChange:r}=(0,C.j7)(),c="events",i=E.events,P=[],v=i.reduce((d,l)=>{const g=l.split(".")[0];return d[g]||(d[g]=[]),d[g].push(l),d},{}),h=({target:{name:d,value:l}})=>{const g=new Set(i);l?g.add(d):g.delete(d),r({target:{name:c,value:Array.from(g)}})},f=({target:{name:d,value:l}})=>{const g=new Set(i);l?a[d].forEach(U=>{P.includes(U)||g.add(U)}):a[d].forEach(U=>g.delete(U)),r({target:{name:c,value:Array.from(g)}})};return(0,s.jsx)(z.f,{children:Object.entries(a).map(([d,l])=>(0,s.jsx)(te,{disabledEvents:P,name:d,events:l,inputValue:v[d],handleSelect:h,handleSelectAll:f},d))})},Ce=t=>{const n=["entry.create","entry.update","entry.delete"];return t&&n.push("entry.publish","entry.unpublish"),{entry:n,media:["media.create","media.update","media.delete"]}},te=({disabledEvents:t=[],name:n,events:a=[],inputValue:E=[],handleSelect:r,handleSelectAll:c})=>{const{formatMessage:i}=(0,R.A)(),P=a.filter(l=>!t.includes(l)),v=E.length>0,h=E.length===P.length,f=({target:{name:l}})=>{c({target:{name:l,value:!h}})},d=5;return(0,s.jsxs)(Z.N,{children:[(0,s.jsx)(I.N,{children:(0,s.jsx)(S.S,{indeterminate:v&&!h,"aria-label":i({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:n,onChange:f,value:h,children:Te(n)})}),a.map(l=>(0,s.jsx)(I.N,{children:(0,s.jsx)(K.J,{disabled:t.includes(l),"aria-label":l,name:l,value:E.includes(l),onValueChange:g=>r({target:{name:l,value:g}})})},l)),a.length<d&&(0,s.jsx)(I.N,{colSpan:d-a.length})]})},Te=t=>t.replace(/-/g," ").split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()).join(" "),F={Root:De,Headers:fe,Body:Ae,Row:te},ne=()=>(0,s.jsxs)(F.Root,{children:[(0,s.jsx)(F.Headers,{}),(0,s.jsx)(F.Body,{})]}),ae=()=>{const{formatMessage:t}=(0,R.A)(),{values:n,errors:a}=(0,C.j7)();return(0,s.jsxs)(u.s,{direction:"column",alignItems:"stretch",gap:1,children:[(0,s.jsx)(M.d,{children:t({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})}),(0,s.jsx)(T.a,{padding:8,background:"neutral100",hasRadius:!0,children:(0,s.jsx)(C.ED,{validateOnChange:!1,name:"headers",render:({push:E,remove:r})=>(0,s.jsxs)(o.x,{gap:4,children:[n.headers.map((c,i)=>{const P=a.headers?.[i],v=typeof P=="object"?P.key:void 0,h=typeof P=="object"?P.value:void 0;return(0,s.jsxs)(m.Fragment,{children:[(0,s.jsx)(_.E,{col:6,children:(0,s.jsx)(C.D0,{as:xe,name:`headers.${i}.key`,"aria-label":`row ${i+1} key`,label:t({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:v})}),(0,s.jsx)(_.E,{col:6,children:(0,s.jsxs)(u.s,{alignItems:"flex-end",children:[(0,s.jsx)(T.a,{style:{flex:1},children:(0,s.jsx)(C.D0,{as:G.k,name:`headers.${i}.value`,"aria-label":`row ${i+1} value`,label:t({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:h})}),(0,s.jsx)(u.s,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:h?0:5,children:(0,s.jsx)(p.yX,{disabled:n.headers.length===1,onClick:()=>r(i),label:t({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:i+1})})})]})})]},`${i}.${c.key}`)}),(0,s.jsx)(_.E,{col:12,children:(0,s.jsx)(ie.Q,{type:"button",onClick:()=>{E({key:"",value:""})},startIcon:(0,s.jsx)(Me.A,{}),children:t({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"})})})]})})})]})},xe=({name:t,onChange:n,value:a,...E})=>{const{values:{headers:r}}=(0,C.j7)(),[c,i]=m.useState([...We]);m.useEffect(()=>{const h=We.filter(f=>!r?.some(d=>d.key!==a&&d.key===f));i(h)},[r,a]);const P=h=>{n({target:{name:t,value:h}})},v=h=>{i(f=>[...f,h]),P(h)};return(0,s.jsx)(b.nP,{...E,onClear:()=>P(""),onChange:P,onCreateOption:v,placeholder:"",value:a,children:c.map(h=>(0,s.jsx)(O.j,{value:h,children:h},h))})},We=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],Ie=({isPending:t,onCancel:n,response:a})=>{const{statusCode:E,message:r}=a??{},{formatMessage:c}=(0,R.A)();return(0,s.jsx)(T.a,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0,children:(0,s.jsxs)(o.x,{gap:4,style:{alignItems:"center"},children:[(0,s.jsx)(_.E,{col:3,children:(0,s.jsx)(y.o,{children:c({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"})})}),(0,s.jsx)(_.E,{col:3,children:(0,s.jsx)(pe,{isPending:t,statusCode:E})}),(0,s.jsx)(_.E,{col:6,children:t?(0,s.jsx)(u.s,{justifyContent:"flex-end",children:(0,s.jsx)("button",{onClick:n,type:"button",children:(0,s.jsxs)(u.s,{gap:2,alignItems:"center",children:[(0,s.jsx)(y.o,{textColor:"neutral400",children:c({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})}),(0,s.jsx)(Q,{as:ee.A,color:"neutral400"})]})})}):(0,s.jsx)(Re,{statusCode:E,message:r})})]})})},Q=X.Ay.svg(({theme:t,color:n})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;


  ${n?(0,X.AH)`
          path {
            fill: ${t.colors[n]};
          }
        `:""}
`),pe=({isPending:t,statusCode:n})=>{const{formatMessage:a}=(0,R.A)();return t||!n?(0,s.jsxs)(u.s,{gap:2,alignItems:"center",children:[(0,s.jsx)(Q,{as:he.A}),(0,s.jsx)(y.o,{children:a({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"})})]}):n>=200&&n<300?(0,s.jsxs)(u.s,{gap:2,alignItems:"center",children:[(0,s.jsx)(Q,{as:q.A,color:"success700"}),(0,s.jsx)(y.o,{children:a({id:"Settings.webhooks.trigger.success",defaultMessage:"success"})})]}):n>=300?(0,s.jsxs)(u.s,{gap:2,alignItems:"center",children:[(0,s.jsx)(Q,{as:ee.A,color:"danger700"}),(0,s.jsxs)(y.o,{children:[a({id:"Settings.error",defaultMessage:"error"})," ",n]})]}):null},Re=({statusCode:t,message:n})=>{const{formatMessage:a}=(0,R.A)();return t?t>=200&&t<300?(0,s.jsx)(u.s,{justifyContent:"flex-end",children:(0,s.jsx)(y.o,{textColor:"neutral600",ellipsis:!0,children:a({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"})})}):t>=300?(0,s.jsx)(u.s,{justifyContent:"flex-end",children:(0,s.jsx)(u.s,{maxWidth:(0,p.a8)(250),justifyContent:"flex-end",title:n,children:(0,s.jsx)(y.o,{ellipsis:!0,textColor:"neutral600",children:n})})}):null:null},Le=({handleSubmit:t,triggerWebhook:n,isCreating:a,isTriggering:E,triggerResponse:r,data:c})=>{const{formatMessage:i}=(0,R.A)(),[P,v]=m.useState(!1),h=(0,N.p)(ne,async()=>(await e.e(6759).then(e.bind(e,46759))).EventsTableEE),f=l=>Object.keys(l).length?Object.entries(l).map(([g,U])=>({key:g,value:U})):[{key:"",value:""}],d=(0,C.Wx)({initialValues:{name:c?.name||"",url:c?.url||"",headers:f(c?.headers||{}),events:c?.events||[]},async onSubmit(l,g){await t(l,g),g.resetForm({values:l})},validationSchema:Ke({formatMessage:i}),validateOnChange:!1,validateOnBlur:!1});return h?(0,s.jsx)(C.QI,{value:d,children:(0,s.jsxs)(p.lV,{children:[(0,s.jsx)(W.Q,{primaryAction:(0,s.jsxs)(u.s,{gap:2,children:[(0,s.jsx)(L.$,{onClick:()=>{n(),v(!0)},variant:"tertiary",startIcon:(0,s.jsx)(ge.A,{}),disabled:a||E,size:"L",children:i({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})}),(0,s.jsx)(L.$,{startIcon:(0,s.jsx)(q.A,{}),type:"submit",size:"L",disabled:!d.dirty,loading:d.isSubmitting,children:i({id:"global.save",defaultMessage:"Save"})})]}),title:a?i({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):c?.name,navigationAction:(0,s.jsx)(Ee.N,{as:le.k2,startIcon:(0,s.jsx)(ce.A,{}),to:"/settings/webhooks",children:i({id:"global.back",defaultMessage:"Back"})})}),(0,s.jsx)(D.s,{children:(0,s.jsxs)(u.s,{direction:"column",alignItems:"stretch",gap:4,children:[P&&(0,s.jsx)(Ie,{isPending:E,response:r,onCancel:()=>v(!1)}),(0,s.jsx)(T.a,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0,children:(0,s.jsxs)(u.s,{direction:"column",alignItems:"stretch",gap:6,children:[(0,s.jsxs)(o.x,{gap:6,children:[(0,s.jsx)(_.E,{col:6,children:(0,s.jsx)(C.D0,{as:G.k,name:"name",error:d.errors.name,label:i({id:"global.name",defaultMessage:"Name"}),required:!0})}),(0,s.jsx)(_.E,{col:12,children:(0,s.jsx)(C.D0,{as:G.k,name:"url",error:d.errors.url,label:i({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0})})]}),(0,s.jsx)(ae,{}),(0,s.jsx)(h,{})]})})]})})]})}):null},Ue=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Be=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,Ke=({formatMessage:t})=>x.Ik().shape({name:x.Yj().required(t({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(Ue,t({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:x.Yj().required(t({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(Be,t({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:x.RZ(n=>{const a=x.YO();if(n.length===1){const{key:E,value:r}=n[0];if(!E&&!r)return a}return a.of(x.Ik().shape({key:x.Yj().required(t({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:x.Yj().required(t({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:x.YO()}),je=t=>({...t,headers:t.headers.reduce((n,{key:a,value:E})=>(a!==""&&(n[a]=E),n),{})}),oe=()=>{const n=(0,J.W5)("/settings/webhooks/:id")?.params.id,a=n==="create",{replace:E}=(0,J.W6)(),r=(0,p.hN)(),{_unstableFormatAPIError:c,_unstableFormatValidationErrors:i}=(0,p.wq)(),P=m.useCallback(c,[]),{isLoading:v}=(0,w.u)(),[h,f]=m.useState(!1),[d,l]=m.useState(),{isLoading:g,webhooks:U,error:re,createWebhook:be,updateWebhook:ke,triggerWebhook:$e}=(0,me.u)({id:n},{skip:a});m.useEffect(()=>{re&&r({type:"warning",message:P(re)})},[re,r,P]);const Ne=async()=>{try{f(!0);const $=await $e(n);if("error"in $){r({type:"warning",message:c($.error)});return}l($.data)}catch{r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}finally{f(!1)}},Fe=async($,ye)=>{try{if(a){const A=await be(je($));if("error"in A){(0,N.x)(A.error)&&A.error.name==="ValidationError"?ye.setErrors(i(A.error)):r({type:"warning",message:c(A.error)});return}r({type:"success",message:{id:"Settings.webhooks.created"}}),E(`/settings/webhooks/${A.data.id}`)}else{const A=await ke({id:n,...je($)});if("error"in A){(0,N.x)(A.error)&&A.error.name==="ValidationError"?ye.setErrors(i(A.error)):r({type:"warning",message:c(A.error)});return}r({type:"success",message:{id:"notification.form.success.fields"}})}}catch{r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}};if(g||v)return(0,s.jsx)(p.Bl,{});const[He]=U??[];return(0,s.jsxs)(j.g,{children:[(0,s.jsx)(p.x7,{name:"Webhooks"}),(0,s.jsx)(Le,{data:He,handleSubmit:Fe,triggerWebhook:Ne,isCreating:a,isTriggering:h,triggerResponse:d})]})},Se=Object.freeze(Object.defineProperty({__proto__:null,EditPage:oe,ProtectedEditPage:()=>{const t=(0,N.j)(_e.s);return(0,s.jsx)(p.kz,{permissions:t.settings?.webhooks.update,children:(0,s.jsx)(oe,{})})}},Symbol.toStringTag,{value:"Module"}))},37724:(Y,B,e)=>{e.d(B,{u:()=>b});var s=e(2730),m=e(43348),K=e(91155);const T=K.n.injectEndpoints({endpoints:O=>({getComponents:O.query({query:()=>({url:"/content-manager/components",method:"GET"}),transformResponse:M=>M.data}),getContentTypes:O.query({query:()=>({url:"/content-manager/content-types",method:"GET"}),transformResponse:M=>M.data})}),overrideExisting:!1}),{useGetComponentsQuery:L,useGetContentTypesQuery:S}=T;function b(){const{_unstableFormatAPIError:O}=(0,m.wq)(),M=(0,m.hN)(),o=L(),_=S();s.useEffect(()=>{_.error&&M({type:"warning",message:O(_.error)})},[_.error,O,M]),s.useEffect(()=>{o.error&&M({type:"warning",message:O(o.error)})},[o.error,O,M]);const D=o.isLoading||_.isLoading,W=s.useMemo(()=>(_?.data??[]).filter(j=>j.kind==="collectionType"&&j.isDisplayed),[_?.data]),k=s.useMemo(()=>(_?.data??[]).filter(j=>j.kind!=="collectionType"&&j.isDisplayed),[_?.data]);return{isLoading:D,components:s.useMemo(()=>o?.data??[],[o?.data]),collectionTypes:W,singleTypes:k}}},56601:(Y,B,e)=>{e.d(B,{ProtectedCreatePage:()=>ne});var s=e(58466),m=e(43348),K=e(91155),T=e(89142),L=e(18720),S=e(79412),b=e(9361),O=e(95052),M=e(50682),o=e(20153),_=e(76024),D=e(2730),W=e(34511),k=e(85209),j=e(43900),H=e(69093),I=e(85041),V=e(3891),z=e(90588),Z=e(49382),u=e(12762),ie=e(19292),G=e(9174),y=e(6056),de=e(33854),p=e(31075),le=e(19727),J=e(8184),N=e(11001),w=e(15778),_e=e(81806),Ee=e(95431),ce=e(55688),q=e(32962),ee=e(40060),he=e(26208),ge=e(31666),Me=e(69506),C=e(3691),R=e(2119),x=e(46705),Pe=e(59362),X=e(98907),me=e(28685),ue=e(45946),se=e(6377),De=e(71484),Oe=e(97755),ve=e(85960),fe=e(25395),Ae=e(35771),Ce=e(50885),te=e(66451),Te=e(37724),F=e(6503);const ne=()=>{const ae=(0,K.j)(T.s);return(0,s.jsx)(m.kz,{permissions:ae.settings?.webhooks.create,children:(0,s.jsx)(L.E,{})})}}}]);

"use strict";(self.webpackChunk_MokoshAI_cms=self.webpackChunk_MokoshAI_cms||[]).push([[2089],{12089:(x,A,t)=>{t.d(A,{ProtectedListView:()=>dt});var s=t(58466),i=t(2730),h=t(61680),U=t(18834),I=t(10373),B=t(15659),o=t(43348),E=t(53176),a=t(3891),l=t(96508),e=t(77645),W=t(91155),p=t(36171),C=t(53237),K=t(35163),j=t(79412),z=t(9361),F=t(95052),V=t(50682),Y=t(20153),G=t(76024),u=t(34511),Q=t(85209),X=t(43900),H=t(69093),J=t(85041),n=t(90588),d=t(49382),P=t(12762),D=t(19292),O=t(9174),M=t(6056),r=t(33854),g=t(31075),T=t(19727),y=t(8184),Z=t(11001),w=t(15778),b=t(81806),q=t(95431),tt=t(55688),_=t(32962),st=t(40060),S=t(26208),Ot=t(31666),Tt=t(69506),At=t(3691),mt=t(2119),ct=t(46705),It=t(59362),Ct=t(98907),gt=t(28685),Lt=t(45946),vt=t(6377),Rt=t(71484),ht=t(97755),Ut=t(85960),Bt=t(25395),Wt=t(35771);const ot=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],Et=()=>{(0,o.L4)();const{formatMessage:m}=(0,l.A)(),L=(0,o.hN)(),it=(0,W.j)(c=>c.admin_app.permissions.settings?.["api-tokens"]),{allowedActions:{canCreate:k,canDelete:rt,canUpdate:lt,canRead:v}}=(0,o.ec)(it),{push:at}=(0,e.W6)(),{trackUsage:f}=(0,o.z1)(),{startSection:et}=(0,o.Cx)(),{_unstableFormatAPIError:N}=(0,o.wq)();i.useEffect(()=>{et("apiTokens")},[et]),i.useEffect(()=>{at({search:a.stringify({sort:"name:ASC"},{encode:!1})})},[at]);const Mt=ot.map(c=>({...c,metadatas:{...c.metadatas,label:m(c.metadatas.label)}}));(0,W.b)(()=>{f("willAccessTokenList",{tokenType:C.A})});const{data:R=[],isLoading:nt,error:$}=(0,p.u)(void 0,{skip:!v});i.useEffect(()=>{$&&L({type:"warning",message:N($)})},[$,N,L]),i.useEffect(()=>{f("didAccessTokenList",{number:R.length,tokenType:C.A})},[R,f]);const[Pt]=(0,p.a)(),Dt=async c=>{try{const _t=await Pt(c);if("error"in _t){L({type:"warning",message:N(_t.error)});return}f("didDeleteToken")}catch{L({type:"warning",message:{id:"notification.error",defaultMessage:"Something went wrong"}})}};return(0,s.jsxs)(B.g,{"aria-busy":nt,children:[(0,s.jsx)(o.x7,{name:"API Tokens"}),(0,s.jsx)(U.Q,{title:m({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:m({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:k&&(0,s.jsx)(I.z,{"data-testid":"create-api-token-button",startIcon:(0,s.jsx)(E.A,{}),size:"S",onClick:()=>f("willAddTokenFromList",{tokenType:C.A}),to:"/settings/api-tokens/create",children:m({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"})})}),(0,s.jsxs)(h.s,{children:[!v&&(0,s.jsx)(o.UW,{}),v&&R.length>0&&(0,s.jsx)(K.T,{permissions:{canRead:v,canDelete:rt,canUpdate:lt},headers:Mt,contentType:"api-tokens",isLoading:nt,onConfirmDelete:Dt,tokens:R,tokenType:C.A}),v&&k&&R.length===0&&(0,s.jsx)(o.R1,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:(0,s.jsx)(I.z,{variant:"secondary",startIcon:(0,s.jsx)(E.A,{}),to:"/settings/api-tokens/create",children:m({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"})})}),v&&!k&&R.length===0&&(0,s.jsx)(o.R1,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})]})]})},dt=()=>{const m=(0,W.j)(L=>L.admin_app.permissions.settings?.["api-tokens"].main);return(0,s.jsx)(o.kz,{permissions:m,children:(0,s.jsx)(Et,{})})}},35163:(x,A,t)=>{t.d(A,{T:()=>V});var s=t(58466),i=t(2730),h=t(45227),U=t(7479),I=t(59979),B=t(46067),o=t(94323),E=t(71869),a=t(13775),l=t(20128),e=t(43348),W=t(94475),p=t(76263),C=t(30018),K=t(96508),j=t(77645),z=t(37299),F=t(86784);const V=({permissions:n,headers:d=[],contentType:P,isLoading:D=!1,tokens:O=[],onConfirmDelete:M,tokenType:r})=>{const{canDelete:g,canUpdate:T,canRead:y}=n;return(0,s.jsx)(e.Ee,{headers:d,contentType:P,rows:O,withBulkActions:g||T||y,isLoading:D,onConfirmDelete:M,children:(0,s.jsx)(Y,{tokenType:r,permissions:n,onConfirmDelete:M})})},Y=({tokenType:n,permissions:d,rows:P=[],withBulkActions:D,onConfirmDelete:O})=>{const{canDelete:M,canUpdate:r,canRead:g}=d,[{query:T}]=(0,e.sq)(),{formatMessage:y}=(0,K.A)(),[,Z]=T&&T.sort?T.sort.split(":"):[void 0,"ASC"],{push:w,location:{pathname:b}}=(0,j.W6)(),{trackUsage:q}=(0,e.z1)(),tt=[...P].sort((_,st)=>{const S=_.name.localeCompare(st.name);return Z==="DESC"?-S:S});return(0,s.jsx)(B.N,{children:tt.map(_=>(0,s.jsxs)(o.Tr,{...(0,e.qM)({fn(){q("willEditTokenFromList",{tokenType:n}),w(`${b}/${_.id}`)},condition:r}),children:[(0,s.jsx)(E.Td,{maxWidth:(0,e.a8)(250),children:(0,s.jsx)(a.o,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0,children:_.name})}),(0,s.jsx)(E.Td,{maxWidth:(0,e.a8)(250),children:(0,s.jsx)(a.o,{textColor:"neutral800",ellipsis:!0,children:_.description})}),(0,s.jsx)(E.Td,{children:(0,s.jsx)(a.o,{textColor:"neutral800",children:(0,s.jsx)(e.sR,{timestamp:new Date(_.createdAt)})})}),(0,s.jsx)(E.Td,{children:_.lastUsedAt&&(0,s.jsx)(a.o,{textColor:"neutral800",children:(0,s.jsx)(e.sR,{timestamp:new Date(_.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:y({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]})})}),D&&(0,s.jsx)(E.Td,{children:(0,s.jsxs)(I.s,{justifyContent:"end",children:[r&&(0,s.jsx)(J,{tokenName:_.name,tokenId:_.id}),!r&&g&&(0,s.jsx)(H,{tokenName:_.name,tokenId:_.id}),M&&(0,s.jsx)(X,{tokenName:_.name,onClickDelete:()=>O?.(_.id),tokenType:n})]})})]},_.id))})},G={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},u=({tokenName:n,tokenId:d,buttonType:P="edit",children:D})=>{const{formatMessage:O}=(0,K.A)(),{location:{pathname:M}}=(0,j.W6)();return(0,s.jsx)(Q,{forwardedAs:z.k2,to:`${M}/${d}`,title:O(G[P],{target:n}),children:D})},Q=(0,F.Ay)(l.N)`
  svg {
    path {
      fill: ${({theme:n})=>n.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:n})=>n.colors.neutral800};
      }
    }
  }
`,X=({tokenName:n,onClickDelete:d,tokenType:P})=>{const{formatMessage:D}=(0,K.A)(),{trackUsage:O}=(0,e.z1)(),[M,r]=i.useState(!1),g=()=>{r(!1),O("willDeleteToken",{tokenType:P}),d()};return(0,s.jsxs)(h.a,{paddingLeft:1,onClick:T=>T.stopPropagation(),children:[(0,s.jsx)(U.K,{onClick:()=>{r(!0)},label:D({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${n}`}),name:"delete",borderWidth:0,icon:(0,s.jsx)(C.A,{})}),(0,s.jsx)(e.TM,{onToggleDialog:()=>r(!1),onConfirm:g,isOpen:M})]})},H=({tokenName:n,tokenId:d})=>(0,s.jsx)(u,{tokenName:n,tokenId:d,buttonType:"read",children:(0,s.jsx)(W.A,{})}),J=({tokenName:n,tokenId:d})=>(0,s.jsx)(u,{tokenName:n,tokenId:d,children:(0,s.jsx)(p.A,{width:12})})},36171:(x,A,t)=>{t.d(A,{a:()=>B,b:()=>U,c:()=>I,d:()=>o,u:()=>h});var s=t(91155);const i=s.n.injectEndpoints({endpoints:E=>({getAPITokens:E.query({query:()=>"/admin/api-tokens",transformResponse:a=>a.data,providesTags:(a,l)=>[...a?.map(({id:e})=>({type:"ApiToken",id:e}))??[],{type:"ApiToken",id:"LIST"}]}),getAPIToken:E.query({query:a=>`/admin/api-tokens/${a}`,transformResponse:a=>a.data,providesTags:(a,l,e)=>[{type:"ApiToken",id:e}]}),createAPIToken:E.mutation({query:a=>({url:"/admin/api-tokens",method:"POST",data:a}),transformResponse:a=>a.data,invalidatesTags:[{type:"ApiToken",id:"LIST"}]}),deleteAPIToken:E.mutation({query:a=>({url:`/admin/api-tokens/${a}`,method:"DELETE"}),transformResponse:a=>a.data,invalidatesTags:(a,l,e)=>[{type:"ApiToken",id:e}]}),updateAPIToken:E.mutation({query:({id:a,...l})=>({url:`/admin/api-tokens/${a}`,method:"PUT",data:l}),transformResponse:a=>a.data,invalidatesTags:(a,l,{id:e})=>[{type:"ApiToken",id:e}]})}),overrideExisting:!1}),{useGetAPITokensQuery:h,useGetAPITokenQuery:U,useCreateAPITokenMutation:I,useDeleteAPITokenMutation:B,useUpdateAPITokenMutation:o}=i},53237:(x,A,t)=>{t.d(A,{A:()=>s,T:()=>i});const s="api-token",i="transfer-token"}}]);

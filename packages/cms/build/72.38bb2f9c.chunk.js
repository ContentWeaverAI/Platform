(self.webpackChunk_MokoshAI_cms=self.webpackChunk_MokoshAI_cms||[]).push([[72],{7881:(f,T,s)=>{var e=s(40278),d=s(84665),n=s(70264),c=s(91846),l=n(function(E,p){if(E==null)return[];var M=p.length;return M>1&&c(E,p[0],p[1])?p=[]:M>2&&c(p[0],p[1],p[2])&&(p=[p[0]]),d(E,e(p,1),[])});f.exports=l},13513:(f,T,s)=>{var e=s(15041),d=s(55295),n=s(71319),c=s(49638),l=s(82867),E=s(22265),p=200;function M(j,y,O,P){var I=-1,G=d,V=!0,B=j.length,U=[],k=y.length;if(!B)return U;O&&(y=c(y,l(O))),P?(G=n,V=!1):y.length>=p&&(G=E,V=!1,y=new e(y));e:for(;++I<B;){var S=j[I],$=O==null?S:O(S);if(S=P||S!==0?S:0,V&&$===$){for(var w=k;w--;)if(y[w]===$)continue e;U.push(S)}else G(y,$,P)||U.push(S)}return U}f.exports=M},21376:(f,T,s)=>{var e=s(49638),d=s(90355),n=s(29614),c=s(35771);function l(E,p){var M=c(E)?e:n;return M(E,d(p,3))}f.exports=l},26292:(f,T,s)=>{var e=s(63644);function d(n,c,l){for(var E=-1,p=n.criteria,M=c.criteria,j=p.length,y=l.length;++E<j;){var O=e(p[E],M[E]);if(O){if(E>=y)return O;var P=l[E];return O*(P=="desc"?-1:1)}}return n.index-c.index}f.exports=d},29614:(f,T,s)=>{var e=s(50187),d=s(46244);function n(c,l){var E=-1,p=d(c)?Array(c.length):[];return e(c,function(M,j,y){p[++E]=l(M,j,y)}),p}f.exports=n},42934:(f,T,s)=>{var e=s(13513),d=s(70264),n=s(99123),c=d(function(l,E){return n(l)?e(l,E):[]});f.exports=c},50187:(f,T,s)=>{var e=s(85251),d=s(68967),n=d(e);f.exports=n},63644:(f,T,s)=>{var e=s(41916);function d(n,c){if(n!==c){var l=n!==void 0,E=n===null,p=n===n,M=e(n),j=c!==void 0,y=c===null,O=c===c,P=e(c);if(!y&&!P&&!M&&n>c||M&&j&&O&&!y&&!P||E&&j&&O||!l&&O||!p)return 1;if(!E&&!M&&!P&&n<c||P&&l&&p&&!E&&!M||y&&l&&p||!j&&p||!O)return-1}return 0}f.exports=d},68122:(f,T,s)=>{var e=s(76158);function d(n){var c=n==null?0:n.length;return c?e(n,1,c):[]}f.exports=d},68967:(f,T,s)=>{var e=s(46244);function d(n,c){return function(l,E){if(l==null)return l;if(!e(l))return n(l,E);for(var p=l.length,M=c?p:-1,j=Object(l);(c?M--:++M<p)&&E(j[M],M,j)!==!1;);return l}}f.exports=d},84665:(f,T,s)=>{var e=s(49638),d=s(97672),n=s(90355),c=s(29614),l=s(95651),E=s(82867),p=s(26292),M=s(80782),j=s(35771);function y(O,P,I){P.length?P=e(P,function(B){return j(B)?function(U){return d(U,B.length===1?B[0]:B)}:B}):P=[M];var G=-1;P=e(P,E(n));var V=c(O,function(B,U,k){var S=e(P,function($){return $(B)});return{criteria:S,index:++G,value:B}});return l(V,function(B,U){return p(B,U,I)})}f.exports=y},90072:(f,T,s)=>{"use strict";s.r(T),s.d(T,{default:()=>ds});var e=s(58466),d=s(2730),n=s(43348),c=s(77645),l=s(70498),E=s(95811),p=s(49662),M=s(6814),j=s(45227),y=s(16113),O=s(15763),P=s(38973),I=s(12688),G=s(7479),V=s(64469),B=s(28535),U=s(61680),k=s(18834),S=s(47525),$=s(77271),w=s(15659),b=s(59979),Ce=s(60783),Re=s(46067),ve=s(48065),re=s(94323),N=s(71869),ae=s(88663),oe=s(50389),C=s(13775),le=s(9891),Le=s(63440),de=s(81100),Te=s(84545),Be=s(76263),be=s(53176),Ue=s(30018),ce=s(85209),K=s(96508),H=s(90588),v=s(17226),We=s(15778),ue=s(7881),Z=s(49382),X=s(86784),ge=s(94683),ee=s(31075),Ie=s(42934),Se=s(21376),Ke=s(68122),he=s(12762),$e=s(95431),se=s(69093);const pe=(0,d.createContext)({}),me=({children:t,value:i})=>(0,e.jsx)(pe.Provider,{value:i,children:t}),te=()=>(0,d.useContext)(pe);me.propTypes={children:v.node.isRequired,value:v.object.isRequired};function Ne(t){switch(t){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return We(t.replace("api::","").replace("plugin::",""))}}const Ge=(t,i)=>{const r=Object.keys(i).sort().map(a=>({name:a,isOpen:!1}));return{...t,collapses:r}},Ee=(0,X.AH)`
  background: ${t=>t.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Ve=(0,X.Ay)(j.a)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${t=>t.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${t=>t.isActive&&Ee}
  &:hover {
    ${Ee}
  }
`,Fe=X.Ay.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,xe=({subCategory:t})=>{const{formatMessage:i}=(0,K.A)(),{onChange:r,onChangeSelectAll:a,onSelectedAction:g,selectedAction:o,modifiedData:h}=te(),x=(0,d.useMemo)(()=>Z(h,t.name,{}),[h,t]),m=(0,d.useMemo)(()=>Object.values(x).every(u=>u.enabled===!0),[x]),_=(0,d.useMemo)(()=>Object.values(x).some(u=>u.enabled===!0)&&!m,[x,m]),D=(0,d.useCallback)(({target:{name:u}})=>{a({target:{name:u,value:!m}})},[m,a]),A=(0,d.useCallback)(u=>o===u,[o]);return(0,e.jsxs)(j.a,{children:[(0,e.jsxs)(b.s,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsx)(j.a,{paddingRight:4,children:(0,e.jsx)(C.o,{variant:"sigma",textColor:"neutral600",children:t.label})}),(0,e.jsx)(Fe,{}),(0,e.jsx)(j.a,{paddingLeft:4,children:(0,e.jsx)(O.S,{name:t.name,value:m,onValueChange:u=>D({target:{name:t.name,value:u}}),indeterminate:_,children:i({id:"app.utils.select-all",defaultMessage:"Select all"})})})]}),(0,e.jsx)(b.s,{paddingTop:6,paddingBottom:6,children:(0,e.jsx)(P.x,{gap:2,style:{flex:1},children:t.actions.map(u=>{const R=`${u.name}.enabled`;return(0,e.jsx)(I.E,{col:6,children:(0,e.jsxs)(Ve,{isActive:A(u.name),padding:2,hasRadius:!0,children:[(0,e.jsx)(O.S,{value:Z(h,R,!1),name:R,onValueChange:W=>r({target:{name:R,value:W}}),children:u.label}),(0,e.jsxs)("button",{type:"button",onClick:()=>g(u.name),style:{display:"inline-flex",alignItems:"center"},children:[(0,e.jsx)(le.s,{as:"span",children:i({id:"app.utils.show-bound-route",defaultMessage:"Show bound route for {route}"},{route:u.name})}),(0,e.jsx)(Te.A,{})]})]})},u.name)})})})]})};xe.propTypes={subCategory:v.object.isRequired};const fe=({name:t,permissions:i})=>{const r=(0,d.useMemo)(()=>ue(Object.values(i.controllers).reduce((a,g,o)=>{const h=`${t}.controllers.${Object.keys(i.controllers)[o]}`,x=ue(Object.keys(g).reduce((m,_)=>[...m,{...g[_],label:_,name:`${h}.${_}`}],[]),"label");return[...a,{actions:x,label:Object.keys(i.controllers)[o],name:h}]},[]),"label"),[t,i]);return(0,e.jsx)(j.a,{padding:6,children:r.map(a=>(0,e.jsx)(xe,{subCategory:a},a.name))})};fe.propTypes={name:v.string.isRequired,permissions:v.object.isRequired};const ze={collapses:[]},ke=(t,i)=>(0,ge.Ay)(t,r=>{switch(i.type){case"TOGGLE_COLLAPSE":{r.collapses=t.collapses.map((a,g)=>g===i.index?{...a,isOpen:!a.isOpen}:{...a,isOpen:!1});break}default:return r}}),we=()=>{const{modifiedData:t}=te(),{formatMessage:i}=(0,K.A)(),[{collapses:r},a]=(0,d.useReducer)(ke,ze,o=>Ge(o,t)),g=o=>a({type:"TOGGLE_COLLAPSE",index:o});return(0,e.jsx)(b.s,{direction:"column",alignItems:"stretch",gap:1,children:r.map((o,h)=>(0,e.jsxs)(E.n,{expanded:o.isOpen,onToggle:()=>g(h),variant:h%2===0?"secondary":void 0,children:[(0,e.jsx)(M.P,{title:Ne(o.name),description:i({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:o.name}),variant:h%2?"primary":"secondary"}),(0,e.jsx)(p.u,{children:(0,e.jsx)(fe,{permissions:t[o.name],name:o.name})})]},o.name))})},He=t=>{switch(t){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Qe=(0,X.Ay)(j.a)`
  margin: -1px;
  border-radius: ${({theme:t})=>t.spaces[1]} 0 0 ${({theme:t})=>t.spaces[1]};
`;function ne({route:t}){const{formatMessage:i}=(0,K.A)(),{method:r,handler:a,path:g}=t,o=g?Ke(g.split("/")):[],[h="",x=""]=a?a.split("."):[],m=He(t.method);return(0,e.jsxs)(b.s,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsxs)(C.o,{variant:"delta",as:"h3",children:[i({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",(0,e.jsx)("span",{children:h}),(0,e.jsxs)(C.o,{variant:"delta",textColor:"primary600",children:[".",x]})]}),(0,e.jsxs)(b.s,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0,children:[(0,e.jsx)(Qe,{background:m.background,borderColor:m.border,padding:2,children:(0,e.jsx)(C.o,{fontWeight:"bold",textColor:m.text,children:r})}),(0,e.jsx)(j.a,{paddingLeft:2,paddingRight:2,children:Se(o,_=>(0,e.jsxs)(C.o,{textColor:_.includes(":")?"neutral600":"neutral900",children:["/",_]},_))})]})]})}ne.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},ne.propTypes={route:v.shape({handler:v.string,method:v.string,path:v.string})};const Ye=()=>{const{formatMessage:t}=(0,K.A)(),{selectedAction:i,routes:r}=te(),a=Ie(i.split("."),"controllers"),g=Z(r,a[0]),o=a.slice(1).join("."),h=ee(g)?[]:g.filter(x=>x.handler.endsWith(o));return(0,e.jsx)(I.E,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"},children:i?(0,e.jsx)(b.s,{direction:"column",alignItems:"stretch",gap:2,children:h.map((x,m)=>(0,e.jsx)(ne,{route:x},m))}):(0,e.jsxs)(b.s,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsx)(C.o,{variant:"delta",as:"h3",children:t({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})}),(0,e.jsx)(C.o,{as:"p",textColor:"neutral600",children:t({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"})})]})})},Xe=(t,i,r)=>({...t,initialData:i,modifiedData:i,routes:r}),Ze={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},Je=(t,i)=>(0,ge.Ay)(t,r=>{switch(i.type){case"ON_CHANGE":{const a=i.keys.length,g=i.keys[a-1]==="enabled";if(i.value&&g){const o=$e(i.keys,a-1).join(".");r.selectedAction=o}he(r,["modifiedData",...i.keys],i.value);break}case"ON_CHANGE_SELECT_ALL":{const a=["modifiedData",...i.keys],g=Z(t,a,{}),o=Object.keys(g).reduce((h,x)=>(h[x]={...g[x],enabled:i.value},h),{});he(r,a,o);break}case"ON_RESET":{r.modifiedData=t.initialData;break}case"ON_SUBMIT_SUCCEEDED":{r.initialData=t.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:a}=i;r.selectedAction=a===t.selectedAction?"":a;break}default:return r}}),Me=(0,d.forwardRef)(({permissions:t,routes:i},r)=>{const{formatMessage:a}=(0,K.A)(),[g,o]=(0,d.useReducer)(Je,Ze,D=>Xe(D,t,i));(0,d.useImperativeHandle)(r,()=>({getPermissions(){return{permissions:g.modifiedData}},resetForm(){o({type:"ON_RESET"})},setFormAfterSubmit(){o({type:"ON_SUBMIT_SUCCEEDED"})}}));const _={...g,onChange:({target:{name:D,value:A}})=>o({type:"ON_CHANGE",keys:D.split("."),value:A==="empty__string_value"?"":A}),onChangeSelectAll:({target:{name:D,value:A}})=>o({type:"ON_CHANGE_SELECT_ALL",keys:D.split("."),value:A}),onSelectedAction:D=>o({type:"SELECT_ACTION",actionToSelect:D})};return(0,e.jsx)(me,{value:_,children:(0,e.jsxs)(P.x,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0",children:[(0,e.jsx)(I.E,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(b.s,{direction:"column",alignItems:"stretch",gap:6,children:[(0,e.jsxs)(b.s,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsx)(C.o,{variant:"delta",as:"h2",children:a({id:(0,l.g)("Plugins.header.title"),defaultMessage:"Permissions"})}),(0,e.jsx)(C.o,{as:"p",textColor:"neutral600",children:a({id:(0,l.g)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."})})]}),(0,e.jsx)(we,{})]})}),(0,e.jsx)(Ye,{})]})})});Me.propTypes={permissions:v.object.isRequired,routes:v.object.isRequired};const _e=(0,d.memo)(Me),je=se.Ik().shape({name:se.Yj().required(n.iW.required),description:se.Yj().required(n.iW.required)}),qe=t=>Object.keys(t).reduce((i,r)=>{const a=t[r].controllers,g=Object.keys(a).reduce((o,h)=>(ee(a[h])||(o[h]=a[h]),o),{});return ee(g)||(i[r]={controllers:g}),i},{}),Pe=()=>{const t=(0,n.hN)(),{get:i}=(0,n.ry)(),{formatAPIError:r}=(0,n.wq)(l.g),[{data:a,isLoading:g,error:o,refetch:h},{data:x,isLoading:m,error:_,refetch:D}]=(0,H.useQueries)([{queryKey:["users-permissions","permissions"],async queryFn(){const{data:{permissions:R}}=await i("/users-permissions/permissions");return R}},{queryKey:["users-permissions","routes"],async queryFn(){const{data:{routes:R}}=await i("/users-permissions/routes");return R}}]),A=async()=>{await Promise.all([h(),D()])};(0,d.useEffect)(()=>{o&&t({type:"warning",message:r(o)})},[t,o,r]),(0,d.useEffect)(()=>{_&&t({type:"warning",message:r(_)})},[t,_,r]);const u=g||m;return{permissions:a?qe(a):{},routes:x??{},getData:A,isLoading:u}},es=()=>{const{formatMessage:t}=(0,K.A)(),i=(0,n.hN)(),{goBack:r}=(0,c.W6)(),{lockApp:a,unlockApp:g}=(0,n.MA)(),{isLoading:o,permissions:h,routes:x}=Pe(),{trackUsage:m}=(0,n.z1)(),_=d.useRef(),{post:D}=(0,n.ry)(),A=(0,H.useMutation)(R=>D("/users-permissions/roles",R),{onError(){i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})},onSuccess(){m("didCreateRole"),i({type:"success",message:{id:(0,l.g)("Settings.roles.created"),defaultMessage:"Role created"}}),r()}}),u=async R=>{a();const W=_.current.getPermissions();await A.mutate({...R,...W,users:[]}),g()};return(0,e.jsxs)(w.g,{children:[(0,e.jsx)(n.x7,{name:"Roles"}),(0,e.jsx)(ce.l1,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:u,validationSchema:je,children:({handleSubmit:R,values:W,handleChange:Q,errors:L})=>(0,e.jsxs)(n.lV,{noValidate:!0,onSubmit:R,children:[(0,e.jsx)(k.Q,{primaryAction:!o&&(0,e.jsx)(y.$,{type:"submit",loading:A.isLoading,startIcon:(0,e.jsx)(de.A,{}),children:t({id:"global.save",defaultMessage:"Save"})}),title:t({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:t({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),(0,e.jsx)(U.s,{children:(0,e.jsxs)(b.s,{background:"neutral0",direction:"column",alignItems:"stretch",gap:7,hasRadius:!0,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,shadow:"filterShadow",children:[(0,e.jsxs)(b.s,{direction:"column",alignItems:"stretch",children:[(0,e.jsx)(C.o,{variant:"delta",as:"h2",children:t({id:(0,l.g)("EditPage.form.roles"),defaultMessage:"Role details"})}),(0,e.jsxs)(P.x,{gap:4,children:[(0,e.jsx)(I.E,{col:6,children:(0,e.jsx)(ae.k,{name:"name",value:W.name||"",onChange:Q,label:t({id:"global.name",defaultMessage:"Name"}),error:L?.name?t({id:L.name,defaultMessage:"Name is required"}):!1,required:!0})}),(0,e.jsx)(I.E,{col:6,children:(0,e.jsx)(oe.T,{id:"description",value:W.description||"",onChange:Q,label:t({id:"global.description",defaultMessage:"Description"}),error:L?.description?t({id:L.description,defaultMessage:"Description is required"}):!1,required:!0})})]})]}),!o&&(0,e.jsx)(_e,{ref:_,permissions:h,routes:x})]})})]})})]})},ss=()=>(0,e.jsx)(n.kz,{permissions:l.P.createRole,children:(0,e.jsx)(es,{})}),ts=()=>{const{formatMessage:t}=(0,K.A)(),i=(0,n.hN)(),{lockApp:r,unlockApp:a}=(0,n.MA)(),{params:{id:g}}=(0,c.W5)("/settings/users-permissions/roles/:id"),{get:o}=(0,n.ry)(),{isLoading:h,routes:x}=Pe(),{data:m,isLoading:_,refetch:D}=(0,H.useQuery)(["users-permissions","role",g],async()=>{const{data:{role:L}}=await o(`/users-permissions/roles/${g}`);return L}),A=d.useRef(),{put:u}=(0,n.ry)(),{formatAPIError:R}=(0,n.wq)(),W=(0,H.useMutation)(L=>u(`/users-permissions/roles/${g}`,L),{onError(L){i({type:"warning",message:R(L)})},async onSuccess(){i({type:"success",message:{id:(0,l.g)("Settings.roles.created"),defaultMessage:"Role edited"}}),await D()}}),Q=async L=>{r();const F=A.current.getPermissions();await W.mutate({...L,...F,users:[]}),a()};return _?(0,e.jsx)(n.Bl,{}):(0,e.jsxs)(w.g,{children:[(0,e.jsx)(n.x7,{name:"Roles"}),(0,e.jsx)(ce.l1,{enableReinitialize:!0,initialValues:{name:m.name,description:m.description},onSubmit:Q,validationSchema:je,children:({handleSubmit:L,values:F,handleChange:J,errors:Y})=>(0,e.jsxs)(n.lV,{noValidate:!0,onSubmit:L,children:[(0,e.jsx)(k.Q,{primaryAction:!h&&(0,e.jsx)(y.$,{disabled:m.code==="strapi-super-admin",type:"submit",loading:W.isLoading,startIcon:(0,e.jsx)(de.A,{}),children:t({id:"global.save",defaultMessage:"Save"})}),title:m.name,subtitle:m.description,navigationAction:(0,e.jsx)(n.N_,{startIcon:(0,e.jsx)(Le.A,{}),to:"/settings/users-permissions/roles",children:t({id:"global.back",defaultMessage:"Back"})})}),(0,e.jsx)(U.s,{children:(0,e.jsxs)(b.s,{background:"neutral0",direction:"column",alignItems:"stretch",gap:7,hasRadius:!0,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,shadow:"filterShadow",children:[(0,e.jsxs)(b.s,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(C.o,{variant:"delta",as:"h2",children:t({id:(0,l.g)("EditPage.form.roles"),defaultMessage:"Role details"})}),(0,e.jsxs)(P.x,{gap:4,children:[(0,e.jsx)(I.E,{col:6,children:(0,e.jsx)(ae.k,{name:"name",value:F.name||"",onChange:J,label:t({id:"global.name",defaultMessage:"Name"}),error:Y?.name?t({id:Y.name,defaultMessage:"Name is required"}):!1,required:!0})}),(0,e.jsx)(I.E,{col:6,children:(0,e.jsx)(oe.T,{id:"description",value:F.description||"",onChange:J,label:t({id:"global.description",defaultMessage:"Description"}),error:Y?.description?t({id:Y.description,defaultMessage:"Description is required"}):!1,required:!0})})]})]}),!h&&(0,e.jsx)(_e,{ref:A,permissions:m.permissions,routes:x})]})})]})})]})},ns=()=>(0,e.jsx)(n.kz,{permissions:l.P.updateRole,children:(0,e.jsx)(ts,{})}),is=(0,X.Ay)(S.N)`
  align-items: center;
  height: ${(0,n.a8)(32)};
  display: flex;
  justify-content: center;
  padding: ${({theme:t})=>`${t.spaces[2]}}`};
  width: ${(0,n.a8)(32)};

  svg {
    height: ${(0,n.a8)(12)};
    width: ${(0,n.a8)(12)};

    path {
      fill: ${({theme:t})=>t.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:t})=>t.colors.neutral800};
      }
    }
  }
`,ie=({sortedRoles:t,canDelete:i,permissions:r,setRoleToDelete:a,onDelete:g})=>{const{formatMessage:o}=(0,K.A)(),{push:h}=(0,c.W6)(),[x,m]=g,_=u=>i&&!["public","authenticated"].includes(u.type),D=u=>{a(u),m(!x)},A=u=>{h(`/settings/users-permissions/roles/${u}`)};return(0,e.jsx)(Re.N,{children:t?.map(u=>(0,e.jsxs)(re.Tr,{...(0,n.qM)({fn:()=>A(u.id)}),children:[(0,e.jsx)(N.Td,{width:"20%",children:(0,e.jsx)(C.o,{children:u.name})}),(0,e.jsx)(N.Td,{width:"50%",children:(0,e.jsx)(C.o,{children:u.description})}),(0,e.jsx)(N.Td,{width:"30%",children:(0,e.jsx)(C.o,{children:o({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {# user} one {# user} other {# users}}"},{number:u.nb_users})})}),(0,e.jsx)(N.Td,{children:(0,e.jsxs)(b.s,{justifyContent:"end",...n.dG,children:[(0,e.jsx)(n.d4,{permissions:r.updateRole,children:(0,e.jsx)(is,{to:`/settings/users-permissions/roles/${u.id}`,"aria-label":o({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${u.name}`}),children:(0,e.jsx)(Be.A,{})})}),_(u)&&(0,e.jsx)(n.d4,{permissions:r.deleteRole,children:(0,e.jsx)(G.K,{onClick:()=>D(u.id),noBorder:!0,icon:(0,e.jsx)(Ue.A,{}),label:o({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${u.name}`})})})]})})]},u.name))})};ie.defaultProps={canDelete:!1},ie.propTypes={onDelete:v.array.isRequired,permissions:v.object.isRequired,setRoleToDelete:v.func.isRequired,sortedRoles:v.array.isRequired,canDelete:v.bool};const rs=async(t,i)=>{try{const{get:r}=(0,n.GD)(),{data:a}=await r("/users-permissions/roles");return i("The roles have loaded successfully"),a}catch(r){throw t({type:"warning",message:{id:"notification.error"}}),new Error(r)}},as=async(t,i)=>{try{const{del:r}=(0,n.GD)();await r(`/users-permissions/roles/${t}`)}catch{i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}},os=()=>{const{trackUsage:t}=(0,n.z1)(),{formatMessage:i,locale:r}=(0,K.A)(),a=(0,n.hN)(),{notifyStatus:g}=(0,$.W)(),[{query:o}]=(0,n.sq)(),h=o?._q||"",[x,m]=(0,d.useState)(!1),[_,D]=(0,d.useState)(!1),[A,u]=(0,d.useState)();(0,n.L4)();const{isLoading:R,allowedActions:{canRead:W,canDelete:Q}}=(0,n.ec)({create:l.P.createRole,read:l.P.readRoles,update:l.P.updateRole,delete:l.P.deleteRole}),{isLoading:L,data:{roles:F},isFetching:J,refetch:Y}=(0,H.useQuery)("get-roles",()=>rs(a,g),{initialData:{},enabled:W}),{includes:ye}=(0,n.U2)(r,{sensitivity:"base"}),De=(0,n.QM)(r,{sensitivity:"base"}),Oe=L||J,cs=()=>{m(!x)},us={roles:{id:(0,l.g)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,l.g)("Roles.empty.search"),defaultMessage:"No roles match the search."}},gs=i({id:"global.roles",defaultMessage:"Roles"}),hs=(0,H.useMutation)(z=>as(z,a),{async onSuccess(){await Y()}}),ps=async()=>{D(!0),await hs.mutateAsync(A),m(!x),D(!1)},q=(F||[]).filter(z=>ye(z.name,h)||ye(z.description,h)).sort((z,Ae)=>De.compare(z.name,Ae.name)||De.compare(z.description,Ae.description)),ms=h&&!q.length?"search":"roles",Es=4,xs=(F?.length||0)+1;return(0,e.jsxs)(V.P,{children:[(0,e.jsx)(n.x7,{name:gs}),(0,e.jsxs)(w.g,{"aria-busy":Oe,children:[(0,e.jsx)(k.Q,{title:i({id:"global.roles",defaultMessage:"Roles"}),subtitle:i({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:(0,e.jsx)(n.d4,{permissions:l.P.createRole,children:(0,e.jsx)(n.z9,{to:"/settings/users-permissions/roles/new",onClick:()=>t("willCreateRole"),startIcon:(0,e.jsx)(be.A,{}),size:"S",children:i({id:(0,l.g)("List.button.roles"),defaultMessage:"Add new role"})})})}),(0,e.jsx)(B.B,{startActions:(0,e.jsx)(n.q7,{label:i({id:"app.component.search.label",defaultMessage:"Search"})})}),(0,e.jsxs)(U.s,{children:[!W&&(0,e.jsx)(n.UW,{}),(Oe||R)&&(0,e.jsx)(n.Bl,{}),W&&q&&q?.length?(0,e.jsxs)(Ce.X,{colCount:Es,rowCount:xs,children:[(0,e.jsx)(ve.d,{children:(0,e.jsxs)(re.Tr,{children:[(0,e.jsx)(N.Th,{children:(0,e.jsx)(C.o,{variant:"sigma",textColor:"neutral600",children:i({id:"global.name",defaultMessage:"Name"})})}),(0,e.jsx)(N.Th,{children:(0,e.jsx)(C.o,{variant:"sigma",textColor:"neutral600",children:i({id:"global.description",defaultMessage:"Description"})})}),(0,e.jsx)(N.Th,{children:(0,e.jsx)(C.o,{variant:"sigma",textColor:"neutral600",children:i({id:"global.users",defaultMessage:"Users"})})}),(0,e.jsx)(N.Th,{children:(0,e.jsx)(le.s,{children:i({id:"global.actions",defaultMessage:"Actions"})})})]})}),(0,e.jsx)(ie,{sortedRoles:q,canDelete:Q,permissions:l.P,setRoleToDelete:u,onDelete:[x,m]})]}):(0,e.jsx)(n.pA,{content:us[ms]})]}),(0,e.jsx)(n.TM,{isConfirmButtonLoading:_,onConfirm:ps,onToggleDialog:cs,isOpen:x})]})]})},ls=()=>(0,e.jsx)(n.kz,{permissions:l.P.accessRoles,children:(0,e.jsx)(os,{})}),ds=()=>(0,e.jsx)(n.kz,{permissions:l.P.accessRoles,children:(0,e.jsxs)(c.dO,{children:[(0,e.jsx)(c.qh,{path:"/settings/users-permissions/roles/new",component:ss,exact:!0}),(0,e.jsx)(c.qh,{path:"/settings/users-permissions/roles/:id",component:ns,exact:!0}),(0,e.jsx)(c.qh,{path:"/settings/users-permissions/roles",component:ls,exact:!0}),(0,e.jsx)(c.qh,{path:"",component:n.hH})]})})},95651:f=>{function T(s,e){var d=s.length;for(s.sort(e);d--;)s[d]=s[d].value;return s}f.exports=T}}]);
